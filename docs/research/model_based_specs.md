# モデルベース仕様記述

## 1. モデルベース開発（MBD）とモデルベースシステムズエンジニアリング（MBSE）

### 1.1 モデルベース開発（MBD）の概念

モデルベース開発（Model-Based Development: MBD）は、テキストベースの仕様書や手書きコードに依存する従来の開発手法に代わり、システムの振る舞いや構造を「モデル」として記述し、そのモデルを開発プロセスの中心に据えるアプローチである。MBDでは、制御アルゴリズムやシステムの動的挙動をグラフィカルなモデルとして表現し、シミュレーションによる早期検証、モデルからの自動コード生成、ハードウェアインザループ（HIL）テストなどを一貫して実施できる。

MBDの典型的なワークフローは以下の通りである：

1. システムの要求定義とモデリング
2. シミュレーションによる設計検証
3. ラピッドプロトタイピング
4. モデルからの自動コード生成
5. 実機テストと検証

### 1.2 モデルベースシステムズエンジニアリング（MBSE）の概念

MBSE（Model-Based Systems Engineering）は、システム開発ライフサイクルの上流工程（要求定義、システム設計、アーキテクチャ設計など）に重点を置いた手法であり、システム全体の複雑さを管理し、異なる専門分野間の連携を円滑にすることを主な目的とする。MBSEにおける「モデル」とは単なる図面ではなく「情報の構造体」を指し、設計や分析結果、判断基準だけでなく、担当者、日程、コストなどのプロジェクト情報も含む。

MBSEの三つの主要な構成要素は以下の通りである：

- **システムアーキテクチャモデル（SAM）**: システムの構造・振る舞い・要求のトレーサビリティを統合的に表現
- **エンジニアリングシミュレーション**: モデルに基づく性能・安全性の解析
- **データ集約基盤**: 複数モデル間の一貫性を維持する情報管理

### 1.3 MBDとMBSEの違い

MBDは主に制御系ソフトウェアの設計・実装に焦点を当て、MATLAB/Simulinkなどのツールを用いた制御モデルの構築とコード生成を中心とする。一方、MBSEはシステム全体の要求分析・アーキテクチャ設計・統合検証を対象とし、SysMLなどのモデリング言語を用いてシステム全体像を記述する。両者は補完関係にあり、MBSEで定義されたシステム仕様がMBDでの詳細設計・実装へと引き継がれる。

## 2. 主要なモデリング言語

### 2.1 UML（Unified Modeling Language）

UMLはソフトウェアシステムの設計・文書化のための標準的なモデリング言語である。UML 2.5では14種類のダイアグラムが定義されており、大きく構造図と振る舞い図に分類される。

**構造図（Structure Diagrams）：**

- **クラス図**: システムのクラス、属性、操作、およびクラス間の関係を記述する最も一般的なUML図
- **コンポーネント図**: ソフトウェアシステムのコンポーネントとサブコンポーネントへの分解を表現
- **配置図**: システムの物理的な配置構成を記述
- **オブジェクト図**: クラス図の特定時点でのインスタンスを表現
- **パッケージ図**: パッケージ間の依存関係を整理
- **複合構造図**: クラスの内部構造を記述
- **プロファイル図**: UMLの拡張メカニズムを定義

**振る舞い図（Behavior Diagrams）：**

- **ユースケース図**: システムとアクター間のインタラクションを記述
- **アクティビティ図**: ワークフローや並行処理の制御フローを表現
- **ステートマシン図**: オブジェクトの状態と状態遷移を記述
- **シーケンス図**: オブジェクト間の相互作用の時系列順序を表現
- **コミュニケーション図**: オブジェクト間のメッセージのやりとりを構造的に表現
- **タイミング図**: 時間的制約を持つ振る舞いを記述
- **インタラクション概要図**: インタラクションの全体像を俯瞰

### 2.2 SysML（Systems Modeling Language）

SysMLはUMLのサブセットを拡張したシステムモデリング言語であり、MBSEにおける標準的な記述言語である。UMLがソフトウェアに特化しているのに対し、SysMLはハードウェア、ソフトウェア、情報、プロセス、人員、施設を含むシステム全体を対象とする。SysMLは要求図（Requirements Diagram）やパラメトリック図（Parametric Diagram）など、システムエンジニアリング固有のダイアグラムを追加している。

### 2.3 AADL（Architecture Analysis & Design Language）

AADLはもともと航空電子（アビオニクス）分野のドメイン固有言語として誕生し、その後、組込みリアルタイムシステム全般をカバーするよう拡張された。AADLはシステムのハードウェア構成、ソフトウェアコンポーネント、それらの結合関係、およびタイミング特性を形式的に記述できる。モデル検査ツールとの連携により、スケジューラビリティ解析やリソース競合の検出が可能である。

### 2.4 EAST-ADL

EAST-ADLは自動車組込みシステム向けのアーキテクチャ記述言語であり、欧州の複数の研究プロジェクトで開発された。UML、SysML、AADLの概念をベースにしつつ、自動車固有のニーズとAUTOSARとの整合性を考慮して設計されている。EAST-ADLがカバーする側面には、車両機能（Feature）、機能アーキテクチャ、要求、可変性（Variability）、ソフトウェアコンポーネント、ハードウェアコンポーネント、通信が含まれる。AUTOSARがランタイムアーキテクチャの詳細を扱うのに対し、EAST-ADLはより高い抽象度での記述を担う。

## 3. シミュレーション環境

### 3.1 MATLAB/Simulink

MathWorks社のMATLAB/Simulinkは、モデルベース開発において最も広く使用されるツール群である。Simulinkはブロックダイアグラム環境で動的システムのモデリングを行い、マルチドメインモデルによるシステム設計、ハードウェア実装前のシミュレーション、コードを書かないデプロイメントを実現する。自動車、航空宇宙、防衛産業で特に広く採用されている。

主要な関連ツールボックスには以下がある：

- **Simulink**: ブロックダイアグラムによるシステムモデリング
- **Stateflow**: 状態遷移とフローチャートによる制御ロジックの記述
- **Simulink Coder / Embedded Coder**: C/C++コードの自動生成
- **Simulink Test**: テスト管理・自動テスト実行
- **Simulink Design Verifier**: 形式検証によるモデルの検証

### 3.2 Modelica

Modelicaはオープンなオブジェクト指向のモデリング言語であり、マルチドメインの物理システム（機械、電気、熱、流体など）を方程式ベースで記述できる。Simulinkがブロックダイアグラム（因果的モデリング）を主体とするのに対し、Modelicaは非因果的（宣言的）モデリングをサポートし、物理法則をより自然に表現できる。主要な実行環境としてOpenModelica、Dymola、Wolfram SystemModelerなどがある。Modelicaはモデルの再利用性が高く、AI支援型のシステムモデリングにおいても将来性のあるプラットフォームとして注目されている。

### 3.3 Stateflow

StateflowはMATLAB/Simulink環境に統合された状態遷移モデリングツールである。有限状態マシン、フローチャート、状態遷移表、真理値表を組み合わせて複雑な制御ロジックを記述できる。Stateflowで記述した状態遷移モデルはSimulinkモデルに組み込むことができ、Embedded Coderによるコード生成の対象にもなる。

## 4. 状態遷移モデル

### 4.1 ステートマシン図

UMLのステートマシン図（状態機械図）は、オブジェクトの状態と、イベントに応じた状態遷移を記述する。階層的な状態（ネストされた状態）、並行状態（直交リージョン）、履歴擬似状態などの概念により、複雑な振る舞いを構造的に表現できる。組込みシステムのプロトコル仕様や制御ロジックの記述に広く用いられる。

### 4.2 ステートチャート（Harel Statecharts）

David Harelが1987年に提案したステートチャートは、古典的な有限状態マシンを拡張し、階層化、並行性、ブロードキャスト通信の概念を導入した。ステートチャートはUMLステートマシン図の理論的基盤となっており、Stateflowの設計思想にも大きな影響を与えている。

### 4.3 ペトリネット

ペトリネットは並行システムの形式的記述に適した数学的モデルであり、トークンの移動によりシステムの動的振る舞いを表現する。デッドロック検出、到達可能性解析、有界性検証など、豊富な解析手法が確立されている。UMLステートマシン図からペトリネットへの変換手法が研究されており、ステートマシンの形式的検証にペトリネットの解析ツールを活用するアプローチが採られている。最近の研究では、色付きペトリネット（Coloured Petri Nets）を用いた並行UMLステートマシンの形式化も進んでいる。

## 5. 産業界での適用

### 5.1 自動車産業：AUTOSARとMATLAB/Simulinkベースの開発

AUTOSAR（AUTomotive Open System ARchitecture）は2003年に設立された自動車業界のグローバルな標準化パートナーシップであり、ECU（電子制御ユニット）向けのオープンなソフトウェアアーキテクチャを規定する。AUTOSARは以下の二つのプラットフォームを提供する：

- **AUTOSAR Classic**: 安定した要求を持つ従来の制御系アプリケーション向け。事前定義されたモジュールセットによる一貫した開発を実現
- **AUTOSAR Adaptive**: コネクテッドカーや自動運転など、動的で複雑なシステム向け。柔軟な構成変更に対応

自動車業界では、MATLAB/Simulinkを用いてAUTOSARソフトウェアコンポーネントを開発するワークフローが確立されている。制御アルゴリズムをSimulinkでモデリングし、AUTOSAR準拠のコードをEmbedded Coderで自動生成するアプローチにより、パワートレイン制御、シャシー制御、ADAS（先進運転支援システム）などの開発が行われている。

### 5.2 航空宇宙産業：DO-178CとAADL

RTCA DO-178C「航空機搭載システム・機器認証におけるソフトウェア考慮事項」は、航空機搭載ソフトウェアの開発・検証・妥当性確認のための安全性規格である。DO-178Cは71の目標を含み、そのうち43が検証に関するものである。設計保証レベル（DAL）の概念により、ソフトウェアの航空機安全性への寄与度に応じた厳格さが要求される。

DO-178Cの重要な補足文書として以下がある：

- **DO-331**: モデルベース開発・検証の補足。モデリング技法を活用して開発・検証を改善する方法を規定
- **DO-332**: オブジェクト指向技術の補足
- **DO-333**: 形式手法の補足

AADLは航空宇宙分野でシステムアーキテクチャの形式的記述に活用されており、タイミング解析、リソース割当解析、安全性解析などがモデルレベルで実施可能である。NASAのマーシャル宇宙飛行センターでもSimulinkベースのコード生成が研究・適用されている。

## 6. モデルからのコード自動生成

モデルベース開発における自動コード生成は、検証済みのモデルからC/C++などの実装コードを自動的に生成する技術である。主要なツールと特徴は以下の通りである。

**Simulink Embedded Coder**は、Simulinkモデル、Stateflowチャート、MATLAB関数から、一貫性のある可読性の高いポータブルなC/C++コードを自動生成する。生成コードの実行性能の最適化やメモリフットプリントの最小化が可能であり、手作業によるコーディングエラーを排除できる。

**コード生成の利点：**
- 手書きコードに比べてヒューマンエラーを大幅に削減
- モデルとコードの一貫性が保証される
- 開発サイクルの短縮とラピッドプロトタイピングの実現
- 認証・規格適合の効率化（DO-178C DO-331、ISO 26262など）

**課題：**
- ツールのライセンスコストが高額（特に中小企業やスタートアップにとって負担）
- 生成コードの最適性が手書きコードに劣る場合がある
- リアルタイム制約への対応にはモデル構築時の注意が必要
- ツールチェーン全体の習熟に時間がかかる

## 7. デジタルツインと仕様の関係

デジタルツイン（Digital Twin）は、物理的な実体のデジタルな複製であり、リアルタイムデータとシミュレーションモデルを組み合わせて、物理システムのライフサイクル全体にわたる監視・最適化・予測を可能にする技術である。Industry 4.0の中核技術として位置づけられ、2025年の市場規模は約245億ドルと推定され、2032年には約2,593億ドルに成長すると予測されている。

デジタルツインとモデルベース仕様記述の関係は以下の点で密接である：

- **モデル駆動工学（MDE）との統合**: デジタルツイン開発において、モデル駆動工学は効率性と信頼性の向上に不可欠とされる。デジタルツインが維持する実世界のモデルと、デジタルツイン自体のシステムモデルの両方を体系的に開発・保守することが重要である
- **参照アーキテクチャの標準化**: Digital Twin Consortium、ISO 23247（製造業向け）、RAMI 4.0（Reference Architecture Model Industry 4.0）、Asset Administration Shellなどの標準化活動が進行中
- **仕様の実行可能化**: デジタルツインにより、従来の静的な仕様記述が動的でシミュレーション可能な「生きた仕様」へと発展する可能性がある

## 8. モデルベースアプローチの利点と課題

### 利点

- **曖昧さの排除**: グラフィカルモデルと形式的意味論により、自然言語仕様の曖昧さを低減
- **早期検証**: シミュレーションにより設計段階でのエラー検出が可能
- **部門横断的なコミュニケーション**: 共通のモデルにより異なる専門分野間の認識を統一
- **トレーサビリティ**: 要求からモデル、モデルからコードへの追跡可能性を確保
- **自動コード生成**: 手作業のコーディングエラーを排除し開発を効率化
- **再利用性**: モデルコンポーネントの再利用によるコスト削減
- **規格適合の支援**: DO-178C、ISO 26262などの安全性規格への適合を体系的に支援

### 課題

- **初期導入コスト**: ツールライセンス、トレーニング、プロセス変更に伴うコストが大きい
- **スケーラビリティ**: 大規模システムではモデルの複雑さが管理困難になる場合がある
- **ツール依存**: 特定のツールベンダーへのロックインリスク
- **形式的意味論の限界**: UMLのような半形式的言語では、意味論の曖昧さが完全には排除されない
- **組織的な変革**: モデルベースへの移行には開発プロセスと組織文化の変革が必要
- **モデルの妥当性確認**: モデル自体が現実を正しく反映しているかの検証が本質的に困難

## 9. まとめ

モデルベース仕様記述は、自然言語による仕様の曖昧さと形式手法の導入障壁の間にある実用的なアプローチとして、特に自動車・航空宇宙産業で広く採用されている。UML/SysMLによるシステムレベルの仕様記述、MATLAB/Simulinkによるシミュレーション可能な制御仕様、AADLやEAST-ADLによるドメイン特化のアーキテクチャ記述など、目的に応じた多様なモデリング手法が存在する。今後はデジタルツインとの融合や、AI技術との統合により、モデルベースアプローチはさらに進化していくと考えられる。
