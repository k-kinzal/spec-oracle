# ハードウェア・組込み領域の仕様記述

## 概要

ハードウェアおよび組込みシステムの設計においては、ソフトウェアとは異なる独自の仕様記述手法が発展してきた。ハードウェア記述言語（HDL）による回路の振る舞い記述、プロパティ仕様言語によるアサーションベース検証、安全規格に基づくコーディング規約、そしてリアルタイム制約の形式的記述など、多層的な仕様体系が産業界の要求に応じて形成されている。本文書では、これらの仕様記述手法を体系的に整理する。

---

## 1. ハードウェア記述言語（HDL）の発展

### 1.1 VHDL

VHDLは1980年代初頭に米国国防総省（DoD）のVHSICプログラムの一環として開発された。1987年にIEEE Std 1076-1987として最初の標準化が行われ、以降1993年、2008年と改訂を重ねている。VHDLはAdaに似た厳格な型システムを持ち、回路の構造と振る舞いの両方を記述できる。欧州の防衛・航空宇宙分野で広く採用され、シミュレーションと合成の両方に対応している。

### 1.2 Verilog

Verilogは1984年にPhil MoorbyとPrabhu GoelによってGateway Design Automation社で開発された。当初はプロプライエタリ言語であったが、1990年にCadence Design Systemsによる買収後、標準化の圧力に対応してオープン化された。1991年にOpen Verilog International（OVI、現Accellera）が設立され、1995年にIEEE 1364として最初の標準化が実現した。C言語に似た構文を持ち、特に北米・アジアの半導体産業で主流となった。

### 1.3 SystemVerilog

SystemVerilogはVerilogの上位互換言語として2005年にIEEE 1800として標準化された。設計記述に加え、検証のための豊富な機能（制約付きランダム生成、カバレッジ、アサーションなど）を統合している。2009年にはVerilog標準（IEEE 1364-2005）がSystemVerilog標準に統合され、IEEE 1800-2009として一本化された。現行版はIEEE 1800-2023である。2018年時点で世界の集積回路設計チームの約80%がVerilogまたはSystemVerilogを使用している。

---

## 2. 高位合成（HLS）言語とツール

高位合成（High-Level Synthesis: HLS）は、CやC++、SystemCなどの高級言語による抽象的な振る舞い記述から、レジスタ転送レベル（RTL）の構造を自動生成する技術である。

### 2.1 主要ツール

- **Vivado HLS（AMD/Xilinx）**: 2011年にXilinxが取得した技術に基づき、FPGA向けに最適化されたHLSツール。ANSI C/C++やSystemCを入力としてFPGA上のハードウェア回路を合成する。ベンダー固有のFPGAボードをターゲットとする。
- **Catapult HLS（Siemens EDA）**: 元Calypto Design Systems、その後Mentor Graphicsを経て2021年にSiemensに統合。C++およびSystemCベースのHLSソリューションで、物理的特性を考慮した最適化、低消費電力推定・最適化に対応する。特定のFPGA/ASICに依存しない技術非依存型のツールであり、任意のターゲットに対してIPを生成できる。
- **Intel HLS Compiler**: Intel FPGA向けに最適化されたHLSツール。

### 2.2 HLSの意義

HLSにより設計の抽象度が向上し、アルゴリズム設計者がハードウェアの詳細を意識せずに回路を生成できるようになった。設計生産性の向上とアーキテクチャ探索の高速化が主な利点である。

---

## 3. プロパティ仕様言語

### 3.1 PSL（Property Specification Language）

PSLはIEEE 1850として標準化されたプロパティ仕様言語で、設計の時間的・論理的性質を形式的に記述する。4つのレイヤーで構成される：

- **ブーリアンレイヤー**: 設計の現在状態をHDL（VHDLまたはVerilog）の式で記述
- **テンポラルレイヤー**: 時間にまたがるシナリオを時相演算子で記述
- **モデリングレイヤー**: 補助的なモデリング構造を提供
- **検証レイヤー**: 検証ディレクティブを定義

### 3.2 SystemVerilog Assertions（SVA）

SVAはSystemVerilog言語のアサーション関連サブセットであり、RTL設計の時間的・論理的性質を検証するための形式仕様言語である。即時アサーション（手続き的コード内で実行）と並行アサーション（シミュレーション全体で監視）の2種類をサポートし、時相含意演算子や遅延構造を構文要素として持つ。シミュレーションベース検証と形式的プロパティ検証（FPV）の両方に対応している。PSLとSVAのプロパティ記述は構文的に類似しており、相互運用が考慮されている。

---

## 4. SystemCとトランザクションレベルモデリング（TLM）

### 4.1 SystemC

SystemCはC++のクラスライブラリとして実装されたシステムレベル設計・検証言語であり、ハードウェア/ソフトウェア協調設計のために開発された。IEEE 1666として標準化されている。RTLからシステムレベルまでの複数の抽象度で設計を記述でき、シミュレーションによる検証が可能である。

### 4.2 TLM（Transaction-Level Modeling）

TLMはSystemC上に構築された通信抽象化フレームワークで、Accellera Systems Initiativeにより標準化されている。RTLモデリングでは遅すぎるシステムレベル分析のために、通信の詳細を機能から分離した高抽象度モデルを提供する。

TLM 2.0の主要なユースケースは以下の通り：
- ソフトウェアアプリケーション開発とHW/SW統合
- ソフトウェア性能解析
- ハードウェアアーキテクチャ解析
- ハードウェア機能検証

テンポラルデカップリングやダイレクトメモリインターフェースなどの技術により、バーチャルプラットフォーム上での高速シミュレーションを実現し、HW/SWの並行開発による設計サイクル短縮に貢献する。

---

## 5. 新世代HDL

従来のVHDL/Verilogの限界を克服するため、ソフトウェア工学のパラダイムを取り入れた新世代のHDLが登場している。

### 5.1 Chisel

Chiselは UC Berkeleyで開発された、Scalaに組み込まれたハードウェア構成言語である。オブジェクト指向と関数型プログラミングの強みを型安全なハードウェア設計に持ち込む。SiFive社のRISC-Vプロセッサ実装をはじめ、多くのRISC-V関連プロジェクトで採用されている。CHIPS Allianceのもとでオープンソースとして開発が進められている。

### 5.2 SpinalHDL

SpinalHDLも同じくScalaベースのHDL DSLで、Chiselと同様にRISC-Vエコシステムの成長とともに採用が広がっている。VexRiscvプロセッサなどの著名な実装で利用されている。

### 5.3 Amaranth HDL

Amaranth HDL（旧nMigen）はPythonベースの現代的なハードウェア定義言語およびツールチェーンである。Pythonのエコシステムを活用し、プロトタイピングや教育用途で特に有用とされる。

### 5.4 産業界での採用状況

これらの新世代HDLはオープンソースコミュニティや研究機関で活発に使用されているが、産業界全体での採用率は依然として従来のVHDL/SystemVerilogに及ばない。ただし、RISC-Vの普及に伴い、特にChiselとSpinalHDLの産業利用は着実に拡大している。

---

## 6. FPGAとASIC設計フロー

### 6.1 ASIC設計フロー

ASIC設計はコンセプトからテープアウトまで以下の段階を経る：

1. **仕様策定とアーキテクチャ設計**: 主要な機能ブロック、データパス、制御構造を定義
2. **RTL設計と検証**: HDLによるRTL記述とシミュレーション等による機能検証
3. **論理合成**: RTLコードをゲートレベルネットリストに変換。面積・消費電力・タイミングを最適化
4. **配置配線（Place and Route）**: 合成済みネットリストの物理レイアウトを生成。フロアプラン、セル配置、配線を含む
5. **物理検証**: LVS（Layout vs. Schematic）、DRC（Design Rule Check）等のサインオフチェック

### 6.2 FPGA設計フロー

FPGA設計はASICと比較して簡素であり、合成から配置配線までを単一のEDAツールで完結できる。再構成可能な論理ブロック（CLB）とプログラマブル配線にマッピングするため、物理設計の複雑さが大幅に軽減される。プロトタイピングや少量生産に適し、設計反復が容易である。

---

## 7. 安全規格における仕様要求

### 7.1 MISRA-C/C++

MISRA（Motor Industry Software Reliability Association）は1998年にC言語のコーディングガイドラインを初版として公開した。安全クリティカルなアプリケーションでのC/C++使用に対し、言語のサブセットと規則を定義する。現行版はMISRA C:2012で、ISO 26262-6:2018から参照されている。未定義動作や実装依存動作の回避、防御的プログラミングの促進が目的である。

### 7.2 DO-178C（航空）

DO-178C/ED-12Cは、民間航空のソフトウェアベースアビオニクスシステムの認証においてFAA、EASA等の当局が参照する主要文書である。ソフトウェアライフサイクル全体（計画、開発、統合プロセス）をカバーし、ソフトウェアの正確性と堅牢性を確保する。ソフトウェアレベル（DAL A〜E）に応じて検証の厳格さが異なり、最高レベルのDAL Aでは形式手法の適用も推奨される。

### 7.3 IEC 61508（産業）

IEC 61508は電気・電子・プログラマブル電子安全関連系の機能安全に関する国際規格であり、多くのドメイン固有規格の基盤となっている。安全度水準（SIL 1〜4）を定義し、各レベルに応じたソフトウェア開発手法と検証手法を要求する。

### 7.4 ISO 26262（自動車）

ISO 26262はIEC 61508を自動車分野に適合させた規格で、自動車安全度水準（ASIL A〜D）を定義する。ソフトウェア開発においては、構造化設計手法、コーディングガイドライン（MISRA-Cの適用）、テスト手法、タイミング制約の仕様化を要求する。2018年の改訂でセミコンダクターやバスシステムにも対象が拡大された。

---

## 8. AUTOSARアーキテクチャと仕様

AUTOSAR（AUTomotive Open System ARchitecture）は車両メーカー、サプライヤー、半導体・ソフトウェア企業による世界的な開発パートナーシップであり、自動車ソフトウェアアーキテクチャの標準化を推進している。

### 8.1 Classic Platform

ハードリアルタイムおよび安全制約のある組込みシステム向けの仕様である。3層のソフトウェアアーキテクチャ（アプリケーション層、ランタイム環境RTE、基本ソフトウェアBSW）をマイクロコントローラ上で動作させる。仮想機能バス（VFB）の概念により、アプリケーションをインフラストラクチャから分離し、ソフトウェアコンポーネントのポータビリティを確保する。ボディ・コンフォート、パワートレイン、シャシー制御、乗員安全の各ドメインに対する広範なアプリケーションインターフェースを定義する。

### 8.2 Adaptive Platform

自動運転やインフォテインメントなど高性能コンピューティングを必要とするECU向けの仕様である。サービス指向アーキテクチャ（SOA）に基づく分散コンピューティング基盤を提供し、メッセージベースの通信メカニズムと柔軟なソフトウェア構成をサポートする。POSIX準拠のOS上で動作し、C++14以降を標準言語とする。

### 8.3 Foundation標準

Classic PlatformとAdaptive Platformの共通部分はAUTOSAR Foundationとして別個に公開され、両プラットフォーム間の相互運用性を保証する。

---

## 9. リアルタイムシステムの仕様記述

### 9.1 タイミング制約

リアルタイムシステムでは、出力の論理的正確性だけでなく、タイミングの正確性も要求される。ハードリアルタイムシステムにおいてデッドラインの違反は、安全クリティカルなアプリケーション（自動車、医療機器等）では人命に関わる事態を引き起こしうる。

### 9.2 最悪実行時間（WCET）解析

WCET（Worst-Case Execution Time）は、特定のハードウェアプラットフォーム上でタスクの実行に要する最大時間である。解析手法は3種類に分類される：

- **静的解析**: プログラムフローとハードウェアモデル（キャッシュ、パイプライン等）に基づき、実機なしでWCETを推定。過度に悲観的な値を出す傾向がある。
- **測定ベース解析**: 実機またはシミュレータ上で短いコードセグメントの実行時間を実測。最悪ケースをカバーしきれないリスクがある。
- **ハイブリッド手法**: 静的解析と実測を組み合わせ、過度な悲観性と楽観性の間のバランスを取る。

ISO 26262ではタイムクリティカルな機能に対し、コードレベルのWCETとシステムレベルの応答時間の両方を安全要求に含めることが求められ、適切なスケジューリング特性への言及もなされている。

---

## 10. ハードウェア/ソフトウェア協調設計での仕様統合

### 10.1 協調設計の概念

ハードウェア/ソフトウェア協調設計（HW/SW Co-Design）は、SoCや組込みコアの設計において、プロセッサ上で実行されるソフトウェアとASIC/FPGA上に実装されるハードウェアの間でタスクを最適に分割する設計手法である。

### 10.2 統合的仕様フレームワーク

協調設計には、仕様策定から合成・シミュレーション・評価に至るまで、ハードウェアとソフトウェアの両コンポーネントを統合する統一的なフレームワークが必要となる。設計初期段階からHWとSWの仕様を統合することで、後工程での統合問題を低減できる。

### 10.3 実践的アプローチ

現代のSoC設計フローでは、SystemCやTLMベースのバーチャルプラットフォームを用い、ハードウェアとソフトウェアの同時並行開発を実現する。部分的に未完成の仕様から始まる並行設計では、ハードウェア設計者、ソフトウェア設計者、システムアーキテクトの間での密接な協力と進捗の同期が不可欠である。MathWorksのMATLAB/SimulinkやSynopsysのバーチャルプロトタイピング環境など、商用ツールがこのワークフローを支援している。

---

## まとめ

ハードウェア・組込み領域の仕様記述は、抽象度の異なる複数の層で構成される体系を形成している。HDLによるRTLレベルの記述、HLSによるアルゴリズムレベルの記述、TLMによるシステムレベルの記述、そしてアサーション言語による性質の形式的記述が相互に補完し合い、設計の正確性と効率性を支えている。安全規格はこれらの仕様記述にさらなる厳格さを要求し、AUTOSARのような産業標準がドメイン固有の仕様フレームワークを提供している。新世代HDLの登場とRISC-Vエコシステムの拡大、そしてHLSの成熟により、仕様記述はより高い抽象度と表現力へと進化を続けている。
