# Assume-Guarantee推論（仮定保証推論）

## 1. 概要

Assume-Guarantee推論（AG推論）は、大規模システムの形式検証における中心的な合成的検証技法である。この手法は、システム全体を一度に検証するのではなく、個々のコンポーネントを分離して検証することで、状態空間爆発の問題を緩和する。AG推論の基本的な考え方は、「コンポーネントMが仮定Aを満たす環境の一部である場合、システムは性質Gを保証する」という形式 ⟨A⟩M⟩G⟩ で表現される。

AG推論は、各コンポーネントが環境について仮定（Assumption）を行い、その仮定の下で自身の振る舞いについて保証（Guarantee）を提供するという原理に基づいている。証明規則により、コンポーネントM1が任意の環境で仮定Aを満たし、コンポーネントM2が仮定Aの下で保証Gを満たす場合、結合システムM1∥M2は保証Gを満たすことが示される。

## 2. コンポーネント的検証手法

### 2.1 合成的検証の原理

コンポーネント的検証手法は、複数の相互作用するコンポーネントから構成されるシステムを、システム全体の大規模なモデルを検証するのではなく、各コンポーネントを分離して分析することで検証する技法である。この手法の核心的なアイデアは、合成的推論を用いて全体の性質を、局所的で扱いやすい性質に還元することにある。

合成的検証は「分割統治（divide and conquer）」戦略に基づいており、大規模システムの検証を管理可能なコンポーネントの検証に分解する。モデル検査における状態爆発問題は、しばしば並行プロセスを結合することから生じるため、合成的アプローチは本質的に重要である。

### 2.2 コンポーネントベースシステムにおける実装

コンポーネントベースソフトウェア開発で使用される主要な手法には、assume-guarantee推論、インターフェース規則、増分的検証がある。assume-guarantee推論とインターフェース規則は、いずれも合成的検証のサブセットであり、分割統治カテゴリに属する。

現代的なアプローチでは、コンポーネントベースのモデリングと推論フレームワークが、モデルをタイミング保証を持つコンポーネント（コントローラの反応性や連続動力学の制御可能性など）に分離する。健全なassume/guarantee式の証明規則を使用して検証を2つの部分に分解することで、離散的振る舞いと連続的振る舞いの合成を避け、状態空間爆発を改善できる。

### 2.3 合成的帰納不変条件の推論

最近の研究（2025年9月）では、Assume-Guarantee推論を通じた合成的帰納不変条件の推論が提案されている。この手法は、パラメータ化されたシステムの合成的検証を可能にする。Assume-Guarantee検証フレームワークはラベル付き遷移システムを使用することが多く、アクションベースの契約を使用する利点は、局所的な帰納不変条件手法で証明可能な状態ベースの契約に変換できることである。

合成的推論手法は、プロセスごと（すなわち局所的）の不変条件の集合を構築し、それらが一緒になって望ましい大域的安全性性質を含意する。合成的帰納不変条件推論技法は、大域的技法よりも効率的に不変条件を推論でき、局所的帰納不変条件は大域的不変条件では提供されない仕様に関するモジュラーな洞察を提供する。

## 3. 環境の仮定と保証の分離

### 3.1 仮定と保証の役割

Assume-Guarantee推論では、システムとその環境がそれぞれ相手の振る舞いについて仮定を行い、その代わりにそれぞれが自身の振る舞いについて何かを保証する。この分離により、検証プロセスがモジュラーになり、管理しやすくなる。

コンポーネントMの文脈的環境についての仮定の下で、各システムコンポーネントを分離して検証する。このような仮定は、アルゴリズム学習を通じて自動的に生成できる。環境モデルは、コンポーネント環境の振る舞いに基づいて計算され、仮定はコンポーネント環境インターフェースの関連規則として生成される。

### 3.2 仮定の自動生成

AG推論における主要な課題は、仮定の自動生成である。モジュラー検証は、assume-guaranteeパラダイムに基づいて状態爆発問題を緩和するが、従来のアプローチでは、ユーザーが環境モデルを指定する必要があったため、完全に自動化されていなかった。

この問題に対処するため、研究者たちは自動化されたアプローチを開発してきた。新しい技法では、環境の振る舞いに基づいてコンポーネントの仮定を自動的に生成する。第一フェーズで状態空間探索技法を使用してコンポーネントの環境を計算し、次に仮定をコンポーネント環境インターフェースの関連規則として生成する。

### 3.3 最弱仮定

最弱仮定は、決定性木オートマトン（DTA）によって正準的に表現でき、アルゴリズムはこのDTAを増分的に自動的に学習できる。学習時間は、等価な最小DTAの状態数に対して多項式時間である。

最弱仮定の概念は理論的に重要であるだけでなく、実用的な検証においても、必要以上に制限的な仮定を避けることができるため有用である。

## 4. 循環AG推論

### 4.1 非循環規則から循環規則へ

従来の自動化されたassume-guarantee推論は、単純な非循環的assume-guarantee規則に制限されていた。しかし、実際の複雑なシステムでは、個々のコンポーネントの検証が相互に依存する循環的なassume-guarantee推論が必要となることが多い。

循環的assume-guarantee推論は、コンポーネントの検証が相互に依存し合う状況を扱うアプローチである。これは、より早期の自動化アプローチが非循環規則に制限されていたのとは対照的である。

### 4.2 循環規則の自動化

最近の研究では、循環的assume-guarantee推論の自動化が実現されている。このアプローチでは、健全かつ完全な循環的assume-guarantee規則を使用し、その規則を使用するために必要な仮定を自動的に構築する方法を記述する。

アルゴリズムは、規則の前提をチェックすることから得られる（偽の）反例に基づいて、仮定に対する結合制約を蓄積する。そして、SATソルバーを使用して、これらの制約を満たす最小の仮定を合成する。

循環規則のために生成された仮定は著しく小さく、より小さな検証問題につながることが実証されている。

### 4.3 N-way分解とアルファベット改良

循環的assume-guarantee推論は、N-way分解とアルファベット改良と組み合わせることで、さらに強力になる。N-way分解は、システムを2つ以上のコンポーネントに分解することを可能にし、アルファベット改良は、各コンポーネントで考慮する必要のあるイベントの集合を最適化する。

これらの技法を組み合わせることで、検証プロセスの効率が大幅に向上し、より大規模で複雑なシステムの検証が可能になる。

## 5. AG推論の健全性

### 5.1 健全性と完全性

AG推論の形式的基盤は、使用される証明規則の健全性と完全性に依存している。健全性は、規則によって導かれる結論が論理的に正しいことを保証し、完全性は、真である性質を証明できることを保証する。

規則2のような基本的なassume-guarantee規則は健全であることが証明されている。さらに、健全かつ完全な循環的assume-guarantee規則が開発されており、これによりより複雑な相互依存関係を持つシステムの検証が可能になる。

### 5.2 証明規則の形式化

基本的なassume-guarantee証明規則の一例を形式的に表現すると以下のようになる：

```
⟨A⟩M1⟨A⟩   ⟨A⟩M2⟨G⟩
―――――――――――――――――――――
    ⟨true⟩M1∥M2⟨G⟩
```

この規則は、M1が任意の環境でAを保証し、M2がAの仮定の下でGを保証するならば、結合システムM1∥M2は無条件にGを満たすことを述べている。

### 5.3 反例の役割

AG推論の自動化において、反例は重要な役割を果たす。モデル検査により得られる反例（しばしば偽の反例）は、仮定を改良するための情報を提供する。仮定は初期的には近似的であり、反例を通じてより精密になる。

反例駆動の改良プロセスは、学習ベースのアプローチにおいて中心的な役割を果たし、検証プロセスが反復的に進行することを可能にする。

## 6. AG推論の自動化（L*アルゴリズム）

### 6.1 L*アルゴリズムの概要

L*アルゴリズムは、正規言語の能動学習のための学習アルゴリズムであり、自動化されたassume-guarantee推論において仮定を発見するために使用される。このフレームワークは、仮定を計算するために既成の学習アルゴリズムを使用する。

L*アルゴリズムをassume-guarantee推論に適用する基本的なアイデアは、「分割統治して学習する（learn to divide and conquer）」ことである。学習アルゴリズムを使用して、検証を可能にする適切な仮定を自動的に発見する。

### 6.2 学習プロセス

学習ベースのassume-guarantee推論では、以下のようなプロセスが実行される：

1. **初期仮定の生成**：最初は近似的な仮定から開始する
2. **コンポーネントの検証**：各コンポーネントを仮定の下で個別に検証する
3. **反例の取得**：検証が失敗した場合、反例が生成される
4. **仮定の改良**：反例を使用して仮定をより精密にする
5. **反復**：検証が成功するまでプロセスを繰り返す

このプロセスは、機械学習の教師あり学習に類似しているが、教師の役割をモデル検査器が果たす点が特徴的である。

### 6.3 能動学習と受動学習

Assume-guarantee推論の自動化には、能動学習と受動学習の両方のアプローチが研究されている。

**能動学習**では、学習アルゴリズムが能動的にクエリを行い、環境の振る舞いについて情報を収集する。L*アルゴリズムは能動学習の代表例である。

**受動学習**（2025年の最新研究）では、与えられたデータから学習を行う。安全性性質と活性性質の両方に対する自動的assume-guarantee推論で受動学習を使用する手法が開発されている。受動学習は、能動学習よりも効率的である場合があり、特に大規模なシステムにおいて有利である。

### 6.4 アルゴリズムのモジュラー性

AG推論のアルゴリズムは、外部の任意の学習アルゴリズムとモデル検査器によってインスタンス化できるという意味でモジュラーである。この柔軟性により、特定のドメインや問題に最適なツールを選択できる。

## 7. 並行システムのモジュラー検証

### 7.1 並行性と状態爆発

並行システムの検証における主要な課題は、プロセスの並行実行によって引き起こされる組み合わせ的爆発である。n個のプロセスがそれぞれm個の状態を持つ場合、結合システムの状態空間はm^n個の状態を持つ可能性がある。

Assume-guarantee推論は、この問題に対する効果的な解決策を提供する。各プロセスを他のプロセスについての仮定の下で個別に検証することで、指数関数的な成長を線形的な成長に削減できる。

### 7.2 CSPとπ計算によるアクションベース合成

CSP（Communicating Sequential Processes）とπ計算からのアクションベースの合成スタイルは、並行システムと分散システムのassume-guarantee推論でしばしば使用される。

これらのプロセス代数は、システムのコンポーネント間の相互作用を明示的にモデル化するための豊かな形式的基盤を提供する。アクションベースのアプローチでは、コンポーネント間の通信イベントを中心に仕様を構築する。

### 7.3 遷移構造とパス意味論

Assume/guarantee技法は、遷移構造とパス意味論に基づく満足性の適切な定義を与えることで適用できる。シミュレーションと等式的抽象化は、コンポーネントごとに実行できる。

遷移構造は、システムの状態とそれらの間の遷移を表現し、パス意味論は、システムの実行トレースに基づいて性質を評価する。この組み合わせにより、並行システムの複雑な振る舞いを形式的に推論できる。

### 7.4 実践的な応用例

並行システムのモジュラー検証は、以下のような実際のシステムに適用されている：

- **Aspnes & Herlihy のランダム化合意アルゴリズム**：分散システムにおける合意問題の検証
- **Zeroconf ネットワーク設定プロトコル**：自動ネットワーク設定の正確性検証
- **コンピュータ制御システム**：差分動力学論理におけるコンピュータ制御システムの並行合成とモジュラー検証

これらの事例は、AG推論が理論的に健全であるだけでなく、実用的に有効であることを実証している。

## 8. AG推論と仕様合成

### 8.1 Assume-Guarantee合成の概念

Assume-guarantee合成は、検証から一歩進んで、仕様から実装を自動的に生成する問題を扱う。環境についての仮定Aとシステムについての保証Gを記述する仕様が与えられたとき、環境と相互作用し、環境がAを満たす場合は常にGを満たすことが保証されるシステムを構築する。

この問題は、従来のモデル検査（「システムは仕様を満たすか？」）よりも困難であるが、より強力である。成功すれば、手動での実装が不要になり、構築によって正しさが保証される。

### 8.2 GR(1)とLTL合成

LTLのGR(1)断片は、assume-guarantee推論をサポートし、合成が効率的なシンボリック解を持つ。GR(1)（Generalized Reactivity(1)）は、以下の形式の仕様を扱う：

```
(□◇φ1 ∧ □◇φ2 ∧ ... ∧ □◇φn) → (□◇ψ1 ∧ □◇ψ2 ∧ ... ∧ □◇ψm)
```

この形式は、「環境が無限にしばしば各φiを満たすならば、システムは無限にしばしば各ψjを満たす」という意味を持つ。GR(1)仕様に対する合成アルゴリズムは多項式時間で実行可能であり、実用的である。

### 8.3 契約からの合成

最近の研究では、assume-guarantee契約から合成を行うアプローチが探求されている。契約ベースの設計では、各コンポーネントが入力に対する仮定と出力に対する保証を持つ契約によって指定される。

契約からの合成の利点は、モジュラー性と再利用性である。個々のコンポーネントの契約から全体システムを合成できれば、設計プロセスが大幅に効率化される。

### 8.4 量的Assume-Guarantee合成

従来のassume-guarantee合成がブール的性質（満たすか満たさないか）を扱うのに対し、量的assume-guarantee合成は、性能やコストなどの量的性質を最適化するシステムの合成を扱う。

この拡張により、「正しい」システムを構築するだけでなく、「最適な」システムを構築することが可能になる。例えば、エネルギー消費を最小化する、応答時間を最短化する、などの目標を持つシステムの合成が可能になる。

## 9. 状態爆発の緩和

### 9.1 状態爆発問題の本質

状態爆発問題は、形式検証において最も深刻な課題の一つである。システムのコンポーネント数が増加するにつれて、全体の状態空間は指数関数的に成長する。例えば、10個のコンポーネントがそれぞれ100個の状態を持つ場合、全体の状態空間は100^10 = 10^20個の状態を持つ可能性がある。

この爆発的成長により、モデル検査が実行不可能になる。従来のモデル検査器は、数百万から数十億の状態までしか扱えないため、現実的な規模のシステムでは直接適用できない。

### 9.2 合成的検証による緩和

Assume-guarantee推論は、状態爆発問題に対する「分割統治」戦略を提供する。システム全体を一度に検証するのではなく、各コンポーネントを個別に検証する。

n個のコンポーネントがそれぞれm個の状態を持つ場合：
- **モノリシック検証**：O(m^n)の状態空間
- **合成的検証**：O(n × m)の状態空間（最良の場合）

この削減は劇的であり、検証不可能だったシステムを検証可能にする。

### 9.3 その他の緩和技法との組み合わせ

Assume-guarantee推論は、他の状態空間削減技法と組み合わせることができる：

**シンボリック表現**：BDD（Binary Decision Diagram）やSMTソルバーを使用して、状態集合を効率的に表現する。

**部分順序削減**：並行システムにおいて、独立した遷移の交換可能性を利用して、探索すべき状態を削減する。

**抽象化**：システムの詳細を抽象化し、より小さな状態空間を持つモデルを作成する。反例駆動の抽象化改良（CEGAR）は、このアプローチを自動化する。

**インクリメンタル検証**：システムの変更時に、影響を受けるコンポーネントのみを再検証する。

これらの技法をassume-guarantee推論と組み合わせることで、さらに大規模なシステムの検証が可能になる。

### 9.4 実証的な効果

研究によれば、循環的assume-guarantee推論で生成された仮定は、非循環的手法で生成された仮定よりも著しく小さく、より小さな検証問題につながる。これは、より効率的な検証だけでなく、より理解しやすい検証結果にもつながる。

実世界のケーススタディでは、assume-guarantee推論により、従来のモノリシック検証では不可能だったシステムの検証が可能になったことが報告されている。

## 10. 実装と応用

### 10.1 AGREE（Assume Guarantee Reasoning Environment）

AGREEは、AADL（Architecture Analysis and Design Language）モデルを分析するツールである。各コンポーネントに提供される仮定と保証の観点から合成が実行される。仮定はコンポーネントが環境に対して持つ期待を記述し、保証はコンポーネントの振る舞いの境界を記述する。

AGREEは、システムアーキテクチャの検証において、assume-guarantee推論を実用的なツールとして提供している。

### 10.2 ニューラルネットワーク検証への応用

2025年の最新研究では、assume-guarantee推論がニューラルネットワークの検証に適用されている。ニューラルネットワークをサブネットワークに分解し、中間述語を通じて検証する。局所的性質が有効であれば、大域的仕様が確認される。

この応用は、assume-guarantee推論が従来のソフトウェアシステムを超えて、機械学習システムの検証にも有効であることを示している。

### 10.3 確率的システムへの拡張

Assume-guarantee推論は、確率的システムにも拡張されている。確率的assume-guarantee検証では、確率的性質（「システムが性質Pを満たす確率が0.99以上である」など）を扱う。

この拡張により、信頼性や可用性などの確率的性質を持つシステムの検証が可能になる。

### 10.4 産業応用

Assume-guarantee推論は、以下のような産業分野で応用されている：

- **航空宇宙**：DO-178C準拠のソフトウェアの検証
- **自動車**：ISO 26262準拠の安全クリティカルシステムの検証
- **医療機器**：IEC 62304準拠のソフトウェアの検証
- **通信プロトコル**：RFC準拠のプロトコル実装の検証

これらの分野では、システムの複雑性とクリティカリティの高さから、assume-guarantee推論のようなモジュラーな検証手法が不可欠である。

## 11. 課題と今後の展望

### 11.1 現在の課題

Assume-guarantee推論には、まだいくつかの課題が残されている：

**適切な仮定の発見**：自動化が進んでいるものの、複雑なシステムでは適切な仮定を発見することが依然として困難である。

**仮定の理解可能性**：自動生成された仮定が大きく複雑になると、人間が理解し検証することが困難になる。

**完全性の限界**：健全な規則を使用しても、全ての真の性質を証明できるとは限らない（完全性の欠如）。

**ツールの成熟度**：理論的な進歩に比べて、実用的なツールの成熟度はまだ十分でない。

### 11.2 今後の研究方向

**AIと機械学習の統合**：より洗練された学習アルゴリズムを使用して、仮定の発見を改善する。

**ヒューマンインザループ**：自動化と人間の直感を組み合わせて、より効果的な検証プロセスを構築する。

**スケーラビリティの向上**：より大規模なシステム（数千から数万のコンポーネント）に対応できるようにする。

**新しいドメインへの適用**：サイバーフィジカルシステム、IoT、クラウドコンピューティングなど、新しいドメインへの適用を探求する。

### 11.3 形式手法の民主化

Assume-guarantee推論のような高度な形式手法を、専門家でない開発者にも使いやすくすることが重要な目標である。ツールの改善、教育の充実、ベストプラクティスの確立などを通じて、形式手法の民主化を進める必要がある。

## 12. まとめ

Assume-Guarantee推論は、大規模システムの形式検証における強力な手法である。コンポーネント的検証、環境の仮定と保証の分離、循環的推論、自動化（L*アルゴリズム）、並行システムのモジュラー検証、仕様合成、状態爆発の緩和など、多くの重要な概念と技法を統合している。

理論的には健全かつ（多くの場合）完全であり、実践的には多くの産業分野で応用されている。自動化の進展により、形式手法の専門家でない開発者にも使いやすくなりつつある。

今後の研究により、さらに大規模で複雑なシステムの検証が可能になり、ソフトウェアの品質と信頼性の向上に貢献することが期待される。Assume-Guarantee推論は、形式検証の実用化における中心的な役割を果たし続けるであろう。

---

## 参考文献・情報源

以下の情報源を参考にしました：

- [Compositional Neural Network Verification via Assume-Guarantee Reasoning](https://roars.dev/pubs/duong2025compositional.pdf)
- [Compositional Inductive Invariant Inference via Assume-Guarantee Reasoning](https://arxiv.org/pdf/2509.06250)
- [Automated Circular Assume-Guarantee Reasoning | SpringerLink](https://link.springer.com/chapter/10.1007/978-3-319-19249-9_3)
- [Automated circular assume-guarantee reasoning | Formal Aspects of Computing](https://link.springer.com/article/10.1007/s00165-017-0436-0)
- [Automatic assume-guarantee reasoning for safety and liveness using passive learning | Formal Methods in System Design](https://link.springer.com/article/10.1007/s10703-025-00484-3)
- [Learning to divide and conquer: applying the L* algorithm to automate assume-guarantee reasoning](https://link.springer.com/article/10.1007/s10703-008-0049-6)
- [Handling State Space Explosion in Component-based Systems](https://arxiv.org/pdf/1709.10379)
- [Assume-Guarantee Reasoning for Safe Component Behaviours](http://www.cs.ox.ac.uk/chris.chilton/publications/facs12-agsafety.pdf)
- [EECS 219C: Computer-Aided Verification Compositional Reasoning](https://people.eecs.berkeley.edu/~sseshia/219c/spr11/lectures/MC-Lec8.pdf)
- [Towards Synthesis from Assume-Guarantee Contracts](https://arxiv.org/pdf/1602.00148)
- [Assume Guarantee Synthesis - UC Berkeley Technical Reports](https://www2.eecs.berkeley.edu/Pubs/TechRpts/2006/EECS-2006-32.pdf)
- [Quantitative Assume Guarantee Synthesis | SpringerLink](https://link.springer.com/chapter/10.1007/978-3-319-63390-9_19)
- [Parallel Composition and Modular Verification of Computer Controlled Systems in Differential Dynamic Logic](https://arxiv.org/abs/1907.02881)
- [Compositional Reasoning in Model Checking | SpringerLink](https://link.springer.com/chapter/10.1007/3-540-49213-5_4)
- [Loonwerks - AGREE Tool](https://loonwerks.com/tools/agree.html)
